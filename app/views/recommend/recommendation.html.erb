<p id="notice"><%= notice %></p>

<h1>Groups recommended for you:</h1>
<% if @current_group.lessee_request.empty? %>
  <h3>No recommendation found. You need to post at least one lessee request</h3>
<% elsif @group_info.empty? %>
  <h3>No recommendation found. You can adjust your request or wait a little longer.</h3>
<% else %>
  <table class="table table-striped table-bordered">
    <thead>
    <tr>
      <th>Group</th>
      <th>Group Member</th>
      <th>Invite/Accept</th>
    </tr>
    </thead>

    <tbody>
    <% @group_info.each do |info| %>
      <tr>
        <td><%= info[:group].id %></td>
        <td>
          <% info[:group].users.each do |user| %>
            <span> <%= user.username %> </span>
          <% end %>
        </td>
        <td>
          <% if info[:received_invitation].nil? %>
            <% if info[:send_invitation].nil? %>
              <span>
              <%= link_to("Invite Group", create_invitation_request_path(info[:group].id), method: :post, class: "btn btn-primary") %>
              </span>
            <% elsif info[:send_invitation].active %>
              <span>Waiting for response</span>
            <% else %>
              <span>people who agree: </span>
              <% info[:send_invitation].agree_users.all.each do |user| %>
                <span><%= user.username %></span>
              <% end %>
              <% if info[:send_invitation].agree_users.find_by(id: current_user.id).nil? %>
                <span>
                  <%= link_to("Agree on sending invitation", agree_on_sending_invitation_path(info[:send_invitation].id), method: :post, class: "btn btn-primary") %>
                </span>
              <% else %>
                <span> waiting for others to agree</span>
              <% end %>
            <% end %>
          <% else %>
              <span>
              <%= link_to("Join Group", agree_on_accepting_invitation_path(info[:received_invitation].id), method: :post, class: "btn btn-primary") %>
            </span>
          <% end %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
<% end %>

